<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YMSH 5th Anniversary</title>
  <link rel="icon" href="/assets/images/ui/YMSH.ico" type="image/x-icon">

  <style>
    body {
      margin: 0;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    #game-container {
      position: relative;
      width: 100vw;
      max-width: 1920px;
      aspect-ratio: 16 / 9;
      overflow: hidden;
    }

    #background {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    #puzzle-base {
      position: absolute;
      width: 27%;
      left: 35%;
      top: 35%;
      z-index: 1;
    }

    #puzzle-pieces .piece {
      position: absolute;
      width: 3.4%;
      z-index: 2;
    }

    #puzzle-complete {
      position: absolute;
      width: 27%;
      left: 35%;
      top: 35%;
      z-index: 3;
      display: none;
    }

    #keychain {
      position: absolute;
      width: 11.5%;
      left: 44.5%;
      top: 10%;
      z-index: 4;
      display: none;
    }

    #strap {
      position: absolute;
      width: 40%;
      left: 5.7%;
      top: 26%;
      z-index: 5;
      display: none;
    }

    /* === 選單區塊 === */

    .ui-box.active {
      pointer-events: auto;
      opacity: 1;
    }

    /* 共通設定 */
    .ui-box img {
      width: 100%;
    }

    #keyBox-wrap {
      position: absolute;
      width: 20%;
      right: 0%;
      top: -15%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
      display: none;
      transition: all 0.3s ease;

      &.hover {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 2;
        opacity: 0;
        transition: opacity .2s ease;
      }

      &.hover.active {
        opacity: 1;
      }

      &:hover,
      &:focus {
        top: 20%;
      }
    }

    #keyBox-wrap img {
      position: absolute;
      width: 100%;
      left: 0;
      top: 0;

      &:first-child {
        position: relative;
        /* 主圖保持原位 */
        z-index: 1;
      }
    }



    #keyBox-wrap .hover.active {
      opacity: 1;
    }



    #keyBox-wrap.active {
      top: 20%;
    }

    #keyBox-wrap .hover {
      opacity: 0;
      transition: opacity .2s ease;
    }

    #keyBox-wrap .hover.active {
      opacity: 1;
    }


    #strapBox-wrap {
      position: absolute;
      width: 20%;
      right: 0%;
      bottom: -74%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
      display: none;
      transition: all 0.3s ease;

      &:hover {
        bottom: -37%;
      }
    }

    #strapBox-wrap.active {
      bottom: -37%;
    }

    area {
      cursor: pointer;
    }

    .test-buttons {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
    }

    .test-btn,
    .test-btn2 {
      position: relative;
      bottom: 400px;
      z-index: 99;
      background: rgba(255, 255, 255, 0.8);
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div id="game-container">
    <img id="background" src="/assets/images/puzzle/Background.png" alt="background">
    <img id="puzzle-base" src="/assets/images/puzzle/Puzzle-base.png" alt="base">

    <div id="puzzle-pieces">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece1.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece2.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece3.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece4.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece5.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece6.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece7.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece8.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece9.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece10.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece11.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece12.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece13.png" alt="">
      <img class="piece" src="/assets/images/puzzle/Puzzle_piece14.png" alt="">
      <!-- ...其餘拼圖塊 -->
    </div>

    <img id="puzzle-complete" src="/assets/images/puzzle/Puzzle-complete.png" alt="complete">
    <img id="keychain" src="/assets/images/puzzle/Keychain-normal.png" alt="keychain">
    <img id="strap" src="/assets/images/puzzle/Strap-white.png" alt="strap">

    <!-- === 鑰匙圈選單 === -->
    <div class="ui-box" id="keyBox-wrap">
      <img id="keyBox" src="/assets/images/puzzle/Keybox.png" usemap="#key-map" alt="">
      <map name="key-map">
        <area target="" alt="normal" title="normal"
          coords="189,322,206,326,219,334,231,343,239,354,242,363,245,376,245,394,242,502,232,505,220,506,231,516,242,533,246,558,237,578,217,596,192,604,165,601,141,585,127,563,126,544,136,519,149,505,152,500,128,498,128,374,146,338,166,326"
          shape="poly">
        <area target="" alt="star" title="star" 
          coords="415,287,428,293,451,363,516,363,530,369,526,385,500,403,485,466,505,504,503,516,489,515,445,496,443,505,457,524,467,548,461,571,446,593,423,600,405,603,378,597,352,580,346,551,359,519,372,505,371,495,342,509,330,518,319,514,316,506,322,486,347,441,295,396,285,380,291,369,307,366,369,365,399,296"
          shape="poly">
        <area target="" alt="circle" title="circle" 
          coords="188,637,212,639,236,650,250,659,262,677,269,693,274,714,272,734,266,753,259,767,249,781,236,789,221,795,207,802,219,809,232,819,242,836,248,855,237,883,225,895,206,906,186,910,165,905,145,895,125,865,129,843,141,820,153,813,166,801,144,792,118,765,104,728,106,694,124,665,146,647,172,638"
          shape="poly">
        <area target="" alt="heart" title="heart" 
          coords="419,638,438,628,457,623,478,629,490,635,503,642,511,654,517,667,518,685,514,702,506,720,477,766,459,786,439,802,438,809,446,816,457,823,466,834,474,850,476,866,473,887,459,902,442,912,417,918,389,912,367,900,357,870,365,843,379,821,386,815,397,810,373,785,359,785,350,783,338,776,328,762,334,751,346,744,337,731,324,699,319,680,326,656,334,645,350,634,369,626,393,626"
          shape="poly">
      </map>
    </div>

    <!-- === 帶子選單 === -->
    <div class="ui-box" id="strapBox-wrap">
      <img id="strapBox" src="/assets/images/puzzle/StrapBox.png" usemap="#strap-map" alt="">
      <map name="strap-map">
        <area target="" alt="white" title="white" href=""
          coords="131,81,250,84,256,323,236,326,234,400,213,397,211,325,131,325,129,212" shape="poly">
        <area target="" alt="pink" title="pink" href=""
          coords="278,325,355,327,357,398,380,399,383,326,400,324,402,81,279,82" shape="poly">
        <area target="" alt="blue" title="blue" href="" coords="421,326,422,82,540,82,544,402,504,403,501,328"
          shape="poly">
        <area target="" alt="yellow" title="yellow" href="" coords="88,325,215,645" shape="rect">
        <area target="" alt="green" title="green" href="" coords="235,326,356,647" shape="rect">
        <area target="" alt="macroon" title="macroon" href="" coords="382,642,504,326" shape="rect">
      </map>
    </div>

    <div class="test-buttons">
      <button class="test-btn">模擬拼圖完成</button>
      <button class="test-btn2">模擬鑰匙圈選完</button>
    </div>
  </div>



  </script>
  <script>
    const puzzleBase = document.querySelector('#puzzle-base');
    const puzzleComplete = document.querySelector('#puzzle-complete');
    const keyBox = document.querySelector('#keyBox');
    const strapBox = document.querySelector('#strapBox');
    const keyBoxWrap = document.querySelector('#keyBox-wrap');
    const strapBoxWrap = document.querySelector('#strapBox-wrap');
    const keyChain = document.querySelector('#keychain');
    const strap = document.querySelector('#strap');



    document.querySelectorAll('map[name="key-map"] area').forEach(a => {
      a.addEventListener('mouseenter', e => {
        const type = e.target.alt;
        keyBox.dataset.old = keyBox.src; // 記錄原圖
        keyBox.src = `/assets/images/puzzle/Keybox_hover_${type}.png`;
      });

      a.addEventListener('mouseleave', () => {
        keyBox.src = keyBox.dataset.old; // 回到原圖
      });

      a.addEventListener('click', e => {
        const type = e.target.alt;
        keyChain.style.display = 'block';
        keyChain.src = `/assets/images/puzzle/Keychain-${type}.png`;

        // 點完關掉選單、進下一階段
        keyBoxWrap.classList.remove('active');
        strapBoxWrap.style.display = 'block';
        strapBoxWrap.classList.add('active');
      });
    });

    document.querySelectorAll('map[name="strap-map"] area').forEach(a => {
      a.addEventListener('mouseenter', e => {
        const type = e.target.alt;
        strapBox.dataset.old = strapBox.src; // 記錄原圖
        strapBox.src = `/assets/images/puzzle/StrapBox_hover_${type}.png`;
      });

      a.addEventListener('mouseleave', () => {
        strapBox.src = strapBox.dataset.old; // 回到原圖
      });
    });



    // 模擬拼圖完成 → 顯示鑰匙圈選單
    document.querySelector('.test-btn').addEventListener('click', () => {
      puzzleBase.style.display = 'none';     // 隱藏底圖
      puzzleComplete.style.display = 'block'; // 顯示完成圖
      keyBoxWrap.style.display = 'block'; // 顯示鑰匙圈選單
      keyBoxWrap.classList.add('active');
      requestAnimationFrame(() => {
        const img = document.querySelector('#keyBox');
        console.log(img.clientWidth); // 這時應該就不是 0 了
        updateImageMap(img);
      });
    });

    // 模擬鑰匙圈選完 → 顯示帶子選單
    document.querySelector('.test-btn2').addEventListener('click', () => {
      strapBoxWrap.style.display = 'block'; // 顯示帶子選單
      strapBoxWrap.classList.add('active');
      requestAnimationFrame(() => {
        const img = document.querySelector('#strapBox');
        console.log(img.clientWidth); // 這時應該就不是 0 了
        updateImageMap(img);
      });
    });

    // 模擬帶子選完（如果想測可再加）
    document.querySelectorAll('area').forEach(a => {
      a.addEventListener('click', e => {
        const mapName = e.target.closest('map').name;

        if (mapName === 'key-map') {
          // 鑰匙圈選完：收回自己 → 開啟帶子選單
          keyBoxWrap.classList.remove('active');
          strapBoxWrap.style.display = 'block';
          strapBoxWrap.classList.add('active');
        }

        if (mapName === 'strap-map') {
          // 帶子選完：收回自己
          strapBoxWrap.classList.remove('active');
        }
      });
    });


    function updateImageMap(img) {
      const map = document.querySelector(`map[name="${img.useMap.slice(1)}"]`);
      if (!map) return;
      const wr = img.clientWidth / img.naturalWidth;
      const hr = img.clientHeight / img.naturalHeight;
      map.querySelectorAll('area').forEach(a => {
        const o = a.dataset.o || a.coords;
        a.dataset.o = o;
        a.coords = o.split(',').map((n, i) => n * (i % 2 ? hr : wr)).join(',');
      });
    }
  </script>
</body>

</html>