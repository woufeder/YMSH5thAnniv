<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YMSH 5th Anniversary</title>
  <link rel="icon" href="assets/images/ui/YMSH.ico" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+Mono+TC:wght@300;400;700&family=Noto+Sans+TC:wght@100..900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

</head>

<body id="index">
  <div>
    <div class="bg"></div>
    <div class="snow-container"></div>
  </div>


  <div class="scene-container container d-flex flex-column justify-content-center align-items-center">

    <button type="button" class="btn question-icon" data-bs-container="body" data-bs-toggle="popover"
      data-bs-placement="right" data-bs-content="本網為噗浪企劃《永明高中》五周年紀念網站。學生名冊之資料屬於角色創作者，官方僅作資料登入，非企劃玩家請勿挪用或進行二次發布。">
      <i class="fa-solid fa-circle-question"></i>
    </button>


    <!-- LOGO層 -->
    <div class="LOGO-layer d-flex flex-column justify-content-center align-items-center">
      <img id="LOGO" src="assets/images/title.png" alt="LOGO" />
      <h4 class="subtitle">五周年紀念網站</h4>
    </div>
    <!-- 輸入名字 -->
    <div>
      <div class="input-group input-group-lg mt-4">
        <input id="playerName" type="text" class="form-control" placeholder="請輸入您的姓名" aria-label="Recipient’s username"
          aria-describedby="submitName">
        <a id="submitName" class="btn btn-primary" type="button" href="preduce.html">確認</a>
      </div>
    </div>
  </div>
  <!-- <script src="js/main.js"></script> -->
  <script src="js/utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
    crossorigin="anonymous"></script>
  <script>
    const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
    const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))

    gsap.to(".bg", {
      duration: 8,
      repeat: -1,
      ease: "none",
      onUpdate() {
        const t = Math.sin(this.progress() * Math.PI * 2) * 0.15 + 0.95; // 在 1.0~1.3 間平滑波動
        const blur = Math.sin(this.progress() * Math.PI * 2) * 1 + 2;    // 在 1~3px 間平滑波動
        gsap.set(".bg", { filter: `blur(${blur}px) brightness(${t})` });
      }
    });


    const snowContainer = document.querySelector(".snow-container");
    const NUM = 30;
    for (let i = 0; i < NUM; i++) {
      const flake = document.createElement("div");
      flake.classList.add("snowflake");
      flake.textContent = "●";
      snowContainer.appendChild(flake);

      const size = Math.random() * 1 + 5;
      const startY = Math.random() * window.innerHeight;   // 從畫面上方不同高度進場
      const drift = Math.random() * 700 + 300;             // 控制整體風向
      const duration = Math.random() * 5 + 6;
      const delay = Math.random() * 5;

      gsap.set(flake, {
        fontSize: size,
        x: -40,                      // 從畫面左外側開始
        y: startY,
        opacity: Math.random() * 0.6 + 0.1
      });

      // 主動畫：水平橫掃
      gsap.to(flake, {
        x: window.innerWidth + 40,   // 掃到畫面右外
        y: startY + drift,           // 帶一點斜率，整體略往下或上
        rotation: Math.random() * 180 - 90,
        duration,
        delay,
        repeat: -1,
        ease: "none"
      });

      // 疊加上下輕微晃動（模擬風浪）
      gsap.to(flake, {
        y: `+=${Math.random() * 200 - 100}`,
        duration: Math.random() * 3 + 2,
        yoyo: true,
        repeat: -1,
        ease: "sine.inOut"
      });
    }

  </script>

  <script src="data/member.js"></script> <!-- 先載入學生名單 -->
  <script>
    const submitName = document.querySelector('#submitName');
    const playerInput = document.querySelector('#playerName');

    submitName?.addEventListener('click', function (e) {
      e.preventDefault();

      const name = (playerInput?.value || '').trim();
      if (!name) {
        alert('請輸入名字');
        playerInput?.focus();
        return;
      }

      localStorage.setItem('playerInput', name); // 使用者輸入的內容

      // 檢查是否載入成功
      if (!window.memberData || !Array.isArray(window.memberData)) {
        console.error('memberData 未載入');
        alert('名冊未載入');
        return;
      }

      // ✅ 用 normalizeName 處理雙方
      const normalizedInput = normalizeName(name);
      const found = window.memberData.find(s => {
        // 主名比對
        if (normalizeName(s.name) === normalizedInput) return true;
        // alias 比對
        if (Array.isArray(s.alias)) {
          return s.alias.some(a => normalizeName(a) === normalizedInput);
        }
        return false;
      });



      if (found) {
        localStorage.setItem('playerRole', found.role);
        localStorage.setItem('playerClass', found.class);
        localStorage.setItem('playerName', found.name); // 名冊內正式名字
      } else {
        localStorage.setItem('playerRole', 'guest');
        localStorage.setItem('playerClass', '訪客');
        localStorage.setItem('playerName', name); // 沒找到就沿用輸入值
      }

      window.location.href = 'preduce.html';
    });



    // 輸入正規化
    function normalizeName(str) {
      return str
        .normalize('NFKC')
        .toLowerCase()
        .replace(/[\u3000]/g, '')
        .replace(/\s+/g, '')
        .replace(/[^\p{L}\p{N}]/gu, '');
    }
  </script>

</body>

</html>